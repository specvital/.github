# SpecVital Architecture

> 🇺🇸 [English Version](../docs/architecture.md)

## Overview

SpecVital은 GitHub 리포지토리의 테스트 파일을 분석하고 시각화하는 플랫폼입니다.

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              SpecVital Platform                                  │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│   ┌──────────────────────────────────────────────────────────────────────────┐  │
│   │                            Web Service                                    │  │
│   │                                                                           │  │
│   │   ┌─────────┐         ┌─────────┐         ┌─────────────────────────┐   │  │
│   │   │   web   │◀──────▶│  Redis  │◀───────▶│       collector         │   │  │
│   │   │         │  Queue  │         │  Queue  │                         │   │  │
│   │   │  API +  │         └─────────┘         │  ┌───────┐  ┌────────┐  │   │  │
│   │   │Dashboard│                             │  │Worker │  │Scheduler│  │   │  │
│   │   └────┬────┘                             │  └───┬───┘  └────────┘  │   │  │
│   │        │                                  │      │                   │   │  │
│   │        │                                  │      ▼                   │   │  │
│   │        │                                  │  ┌───────┐               │   │  │
│   │        │                                  │  │ core  │ (Library)    │   │  │
│   │        │                                  │  └───────┘               │   │  │
│   │        │                                  └──────────┬──────────────┘   │  │
│   │        │                                             │                   │  │
│   │        └──────────────────┬──────────────────────────┘                   │  │
│   │                           │                                              │  │
│   │                           ▼                                              │  │
│   │                   ┌───────────────┐                                      │  │
│   │                   │  PostgreSQL   │                                      │  │
│   │                   └───────────────┘                                      │  │
│   └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## Core Principles

### 역할 분리

| Component     | 핵심 책임                               |
| ------------- | --------------------------------------- |
| **core**      | 테스트 파일 파싱 (핵심 엔진)            |
| **web**       | API 서버 + 대시보드, 큐 생성, 결과 표시 |
| **collector** | 큐 소비, core로 분석, 결과 저장         |
| **infra**     | DB/Redis 제공, 스키마 관리              |

---

## Repositories

### core

**역할**: Tree-sitter 기반 테스트 파서 엔진

| 항목   | 내용      |
| ------ | --------- |
| 언어   | Go        |
| 유형   | Library   |
| 소비자 | collector |

---

### web

**역할**: API 서버 + 대시보드

| 항목   | 내용                                   |
| ------ | -------------------------------------- |
| 스택   | Go + Chi (Backend), Next.js (Frontend) |
| 의존성 | infra (PostgreSQL, Redis)              |

---

### collector

**역할**: 분석 워커

| 항목   | 내용                            |
| ------ | ------------------------------- |
| 언어   | Go                              |
| 의존성 | core, infra (PostgreSQL, Redis) |

---

### infra

**역할**: 중앙 인프라 및 스키마 관리

| 항목        | 플랫폼            |
| ----------- | ----------------- |
| Database    | PostgreSQL (Neon) |
| Queue/Cache | Redis (Upstash)   |
| Schema      | Atlas             |

---

## Data Flow

```
┌─────────┐                                                    ┌─────────┐
│  User   │                                                    │  User   │
└────┬────┘                                                    └────▲────┘
     │ 1. Request                                                   │ 6. View
     ▼                                                              │
┌─────────────────────────────────────────────────────────────────────────────┐
│                              Web Service                                     │
│                                                                              │
│  ┌─────────┐    2. Enqueue     ┌─────────┐    3. Consume    ┌───────────┐  │
│  │   web   │──────────────────▶│  Redis  │◀─────────────────│ collector │  │
│  │  (API)  │                   │ (Queue) │                  │  (Worker) │  │
│  └────┬────┘                   └─────────┘                  └─────┬─────┘  │
│       │                                                           │        │
│       │ 5. Read Results                            4. Parse (core)│        │
│       │                                                           │        │
│       │            ┌──────────────────────────┐                   │        │
│       └───────────▶│       PostgreSQL         │◀──────────────────┘        │
│                    └──────────────────────────┘                            │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

**흐름**:

1. 사용자가 GitHub URL로 분석 요청
2. web이 Redis에 작업 등록
3. collector worker가 작업 수신
4. collector가 core로 테스트 파싱 후 결과 저장
5. web이 DB에서 결과 조회
6. 사용자에게 시각화된 결과 표시

---

## Dependency Graph

```
┌──────────────────────────────────────────────────────────────────┐
│                         Web Service                               │
│                                                                   │
│   ┌─────────┐         ┌─────────┐         ┌─────────────────┐   │
│   │   web   │◀───────▶│  Redis  │◀───────▶│    collector    │   │
│   └────┬────┘  Queue  └─────────┘  Queue  └────────┬────────┘   │
│        │                                           │             │
│        │                                           ▼             │
│        │                                    ┌───────────┐        │
│        │                                    │   core    │        │
│        │                                    │ (Library) │        │
│        │                                    └───────────┘        │
│        │                                           │             │
│        └─────────────────┬─────────────────────────┘             │
│                          │                                        │
│                          ▼                                        │
│                  ┌───────────────┐                               │
│                  │  PostgreSQL   │                               │
│                  └───────────────┘                               │
└──────────────────────────────────────────────────────────────────┘
```

### 의존 관계

| Consumer       | Provider   | 관계 유형        |
| -------------- | ---------- | ---------------- |
| collector      | core       | Go Module Import |
| web, collector | PostgreSQL | 데이터 저장/조회 |
| web, collector | Redis      | 작업 큐          |

---

## Deployment

### 배포 플랫폼

| 서비스              | 플랫폼  |
| ------------------- | ------- |
| PostgreSQL          | Neon    |
| Redis               | Upstash |
| web-backend         | Railway |
| web-frontend        | Vercel  |
| collector-worker    | Railway |
| collector-scheduler | Railway |

### 확장성

| Service               | 확장성        | 비고                 |
| --------------------- | ------------- | -------------------- |
| web                   | 수평 확장     | Stateless            |
| collector (Worker)    | 수평 확장     | Stateless, 병렬 처리 |
| collector (Scheduler) | 단일 인스턴스 | Cron 작업            |
